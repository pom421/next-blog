---
title: R√©installer un mac avec brew bundle et le pattern dotfiles
date: 2023-01-28
description: Comment r√©installer au mieux un mac avec brew bundle et le pattern dotfiles.
tag: next.js
author: You
---

L'outil [brew](https://brew.sh/index_fr) est un outil populaire sous Mac pour la gestion de paquets.

Nous allons voir comment l'utiliser au mieux, afin de pr√©parer le passage d'un mac √† un autre.

## Brew bundle

La commande [`brew bundle`](https://docs.brew.sh/Manpage#bundle-subcommand) permet d'exporter dans un fichier la liste des paquets install√©s.

```shell
brew bundle dump
```

cr√©e un fichier du type : 

```shell
tap "homebrew/bundle"
tap "homebrew/cask"
tap "homebrew/cask-fonts"
tap "homebrew/cask-versions"
tap "homebrew/core"
brew "act"
brew "bandwhich"
cask "libreoffice"
cask "postman"
cask "visual-studio-code"
```

Ce fichier contient tous les tap (les repos de brew), les outils type CLI et les outils graphiques (install√©s avec `brew cask`).

Il devient tr√®s facile d'exporter ce fichier sur un autre mac et installer cette suite d'outils : 

```shell
brew bundle
```

L'id√©al est alors de stocker ce fichier Brewfile sous un repo Git √† soi, pour y avoir acc√®s facilement.

On peut aller encore un cran plus loin, en en utilisant le pattern dotfiles.

### dotfiles

Sous un syst√®me Unix-like (comme Mac OS), les fichiers cach√©s √† la racine (dotfiles) sont utilis√©s pour la configuration des outils.

On peut les conserver et les stocker sous Git, de fa√ßon √† b√©n√©ficier de la m√™me configuration sur plusieurs ordinateurs.

Ce pattern est expliqu√© [ici](https://wiki.archlinux.org/title/Dotfiles).

Simplement cr√©er un r√©pertoire Git √† la racine n'est pas id√©al, car il va rentrer en conflit potentiel, avec d'autres repos qui seront √† la racine. 
L'id√©e est alors d'utiliser un bare repo Git avec un alias.

Voici ma fa√ßon de proc√©der (cr√©dits √† [Siilwyn](https://github.com/Siilwyn/my-dotfiles/tree/master/.my-dotfiles)): 

Installation

```shell
mkdir $HOME/.dotfiles
git init --bare $HOME/.dotfiles
echo "alias dotfiles='/usr/bin/git --git-dir=$HOME/.dotfiles/ --work-tree=$HOME'" >> .zshrc
source .zshrc
dotfiles config status.showUntrackedFiles no # Ceci sera ajout√© √† la config du repo .dotfiles et pas √† la config g√©n√©ral de git
```

R√©plication

```shell
git clone --separate-git-dir=$HOME/.my-dotfiles https://github.com/Siilwyn/my-dotfiles.git my-dotfiles-tmp
rsync --recursive --verbose --exclude '.git' my-dotfiles-tmp/ $HOME/
rm --recursive my-dotfiles-tmp
```

Usage

```shell
dotfiles add Brewfile
dotfiles commit -m "ajout du fichier Brewfile"
dotfiles add .zshrc
dotfiles commit -m "ajout de conf zsh"
dotfiles remote add origin https://github.com/pom421/.dotfiles.git
dotfiles push
```

Configuration 

```shell
dotfiles config status.showUntrackedFiles no
```


Et voila ! üéâ

Nous avons un syst√®me qui peut conserver la trace de tous les outils install√©s et de la configuration de tous ces outils.
On peut ensuite les dupliquer sur un mac vierge et l'installer tr√®s rapidement.
